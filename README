#### BUILDING

# Instructions to build slitheen (client and proxy)

# Requirements (with versions I used, if relevant):
#   ethtool
#   docker.io (18.03.1-ce)
#       be sure to set up Docker for use without sudo by adding the user to the Docker group
#   git (2.7.4)
#   vncviewer
#   golang (>= 1.7)
#   koko (go get github.com/redhat-nfvpe/koko)
#     koko should be installed with owner root, group docker, and mode 04750

mkdir slitheen; cd slitheen

echo "Fetching Slitheen repositories"

# Get the slifox hg repo
git clone https://gitlab.com/slitheen/slifox.git

# Get the slitheen code repos
git clone https://gitlab.com/slitheen/slitheen-client.git
git clone https://gitlab.com/slitheen/slitheen-relay.git

echo "Building and configuring the Docker containers (this may take a while...)"

# Get the build and test environments (Note: this may take a long time)
git clone https://gitlab.com/slitheen/test-env.git
cd test-env
./build-slitheen
./mktestenvconfig
sed -i s,/somewhere/slifox,$(cd ..; /bin/pwd)/slifox, testenv_config
sed -i s,/somewhere/slitheen/slitheen-relay,$(cd ..; /bin/pwd)/slitheen-relay, testenv_config
sed -i s,/somewhere/slitheen/slitheen-client,$(cd ..; /bin/pwd)/slitheen-client, testenv_config

# Start the slifox docker
./ous_run

    # Inside that docker, build slifox and the socks proxy and exit the
    # docker when finished
    ./mach build   # This will take a while
    cd ../client
    make
    exit

# Start the relay station docker
./relay_run

    # Inside that docker, build the slitheen relay
    make
    # Build the key generator and run it
    cd keygen
    make
    ./genkeys
    exit

# Copy the private and public keys to the right places
cp ../slitheen-relay/keygen/privkey ../slitheen-relay
cp ../slitheen-relay/keygen/pubkey ../slifox/
cp ../slitheen-relay/keygen/pubkey ../slitheen-client/

#### RUNNING

# You will need four terminals, each starting in the testenv directory
# (start them in this order):

A. ./relay_run

B. ./ous_run

C. ./socks_run

D. ./net_run

    # Run (as root) the ethtool commands it outputs, if any

# Still in D:
    vncviewer localhost

# In A:
    sudo ./slitheen veth1 eth0

# In B:
    ./mach run  # Wait for it to start up

# In C:
    ./socks


# Now point your browser's SOCKS proxy to localhost:1080 while you load
# youtube videos in slifox
