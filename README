#### BUILDING

# Instructions to build slitheen (client and proxy)

# Requirements (with versions I used):
#   docker (18.03.1-ce)
#   git (2.7.4)
#   mercurial (3.7.3)
#   vncviewer
#   koko (v0.61) from https://github.com/redhat-nfvpe/koko/releases
#     koko should be installed with owner root, group docker, and mode 04750

mkdir slitheen; cd slitheen

# Get the bootstrapped docker image for building slifox
wget https://cs.uwaterloo.ca/~cbocovic/ff_bootstrapped_2018_03_25.tar.gz
echo '6c45728775474f5fdae4b0c7477b1ca71271357cfb04fd29446c99b5ea4adf7b  ff_bootstrapped_2018_03_25.tar.gz' | sha256sum -c
docker load < ff_bootstrapped_2018_03_25.tar.gz
rm ff_bootstrapped_2018_03_25.tar.gz

# Get the slifox hg repo
git clone git@gitlab.com:slitheen/slifox.git

# Get the slitheen code repos
git clone git@gitlab.com:slitheen/slitheen-client.git
git clone git@gitlab.com:slitheen/slitheen-relay.git

# Get the build and test environments
git clone git@gitlab.com:slitheen/test-env.git
cd testenv
./build-slitheen
./mktestenvconfig
sed -i s,/somewhere/slifox,$(cd ..; /bin/pwd)/slifox, testenv_config
sed -i s,/somewhere/slitheen/slitheen-relay,$(cd ..; /bin/pwd)/slitheen-relay, testenv_config
sed -i s,/somewhere/slitheen/slitheen-client,$(cd ..; /bin/pwd)/slitheen-client, testenv_config

# Start the slifox docker
./ous_run

    # Inside that docker, build slifox and the socks proxy and exit the
    # docker when finished
    ./mach build   # This will take a while
    cd ../client
    make
    exit

# Start the relay station docker
./relay_run

    # Inside that docker, build the slitheen relay
    make
    # Build the key generator and run it
    cd keygen
    make
    ./genkeys
    exit

# Copy the private and public keys to the right places
cp ../slitheen-relay/keygen/privkey ../slitheen-relay
cp ../slitheen-relay/keygen/pubkey ../slifox/
cp ../slitheen-relay/keygen/pubkey ../slitheen-client/

#### RUNNING

# You will need four terminals, each starting in the testenv directory
# (start them in this order):

A. ./relay_run

B. ./ous_run

C. ./socks_run

D. ./net_run

    # Run (as root) the ethtool commands it outputs, if any

# Still in D:
    vncviewer localhost # password: 1234 to view slifox

# In A:
    sudo ./slitheen veth1 eth0

# In B:
    ./mach run  # Wait for it to start up

# In C:
    ./socks


# Now point your browser's SOCKS proxy to localhost:1080 while you load
# youtube videos in slifox
